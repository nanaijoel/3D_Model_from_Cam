# config.yaml — wird 1:1 in ENV gemappt

features:
  backend: disk
  device: cuda
  use_mask: true
  max_kp: 25000
  debug_every: 20

  lg:
    detection_threshold: 0.0001
    nms: 2
    resize: 1536
    remove_borders: 2
    force_num: true

  preproc:
    clahe: true
    clahe_clip: 4.0
    clahe_tiles: 16
    unsharp: true
    unsharp_sigma: 1.0
    unsharp_amount: 1.3
    noise: false
    noise_std: 1.5
    mask_dilate: 6

matching:
  backend: lightglue
  features: disk
  ratio: 0.82
  depth_confidence: -1
  width_confidence: -1
  filter_threshold: 0.09

masking:
  enable: true
  method: rembg
  overwrite_images: false
  params:
    alpha_thr: 0.4
    save_debug: true

sfm:
  init_ratio: 0.5
  init_max_span: 8
  densify: true
  use_keyframes: true
  use_loops: true
  pose_smoothing: true
  smooth_lambda: 0.01

mvs:
  enable: true
  mode: "single"
  params:
    device: cuda
    scale: 1.0

    # ---- Frame-Auswahl (bucketed) ----
    ref_strategy: "bucket"   # "bucket" | "bestk" | "step"
    ref_topk: 60             # Anzahl der gewünschten points_ref_XXXX
    ref_min_gap: 3           # Sicherheitsabstand (nur für "bestk")
    ref_step: 3              # nur für "step"

    # ---- Seeds & Fill ----
    seed_radius: 2
    seed_min: 200
    seed_sample: 200000
    beta: 4.0
    fill_iters: 150
    mask_pad: 6

    # ---- Output ----
    export_mesh: false       # <- wir bauen KEIN dense_mesh hier
    poisson_depth: 10

carve:
  enable: true
  use_all_masks: true   # wenn false: nur die Sichten nutzen, für die points_ref_* existieren
  mode: "all"           # "all" (streng), "majority" (robuster), "any" (locker)
  use_depth: false      # optional z-Konsistenz gegen depth_{i}.npy (falls vorhanden)
  depth_tol: 0.02
  chunk: 400000

